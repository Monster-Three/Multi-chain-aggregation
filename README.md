### ğŸ› ï¸ å»ºè®®å¾®è°ƒåçš„æœ€ç»ˆç‰ˆ (ç›´æ¥å¤åˆ¶å³å¯)

```markdown
# ğŸŸ FishCake: Multi-Chain Smart Account & Advanced Oracle Paymaster

**FishCake** æ˜¯ä¸€æ¬¾åŸºäº **ERC-4337 (v0.7.0)** æœ€æ–°æ ‡å‡†æ„å»ºçš„å¤šé“¾èšåˆæ™ºèƒ½è´¦æˆ·è§£å†³æ–¹æ¡ˆã€‚æœ¬é¡¹ç›®é€šè¿‡ **CREATE2** æŠ€æœ¯å®ç°å¤šé“¾åŒåœ°å€éƒ¨ç½²ï¼Œå¹¶é…å¥—äº†ä»åŸºç¡€ç™½åå•åˆ°é‡‘èçº§é¢„è¨€æœºè®¡è´¹çš„ä¸¤ä»£ Paymaster æ¶æ„ï¼Œæ—¨åœ¨æä¾›æ— ç¼ä¸”å¯æŒç»­çš„ Web3 æ”¯ä»˜ä½“éªŒã€‚

---

## ğŸš€ é¡¹ç›®æ ¸å¿ƒäº®ç‚¹

### 1. æ¶æ„æ¼”è¿›ï¼šä» V1 åˆ° V2
æˆ‘ä»¬å±•ç¤ºäº† Paymaster æœºåˆ¶çš„ä¸¤æ¬¡é‡å¤§æŠ€æœ¯è¿­ä»£ï¼Œä½“ç°äº†ä»â€œè¥é”€å·¥å…·â€åˆ°â€œé‡‘èåè®®â€çš„æ·±åº¦æ€è€ƒï¼š

* **V1: FishCakePaymaster (Whitelist Edition)**
    * **æ ¸å¿ƒåŠŸèƒ½**ï¼šåŸºäºç™½åå•çš„ Gas ä»£ä»˜ã€‚
    * **é€‚ç”¨åœºæ™¯**ï¼šæ–°ç”¨æˆ·è·å®¢ï¼ˆå¦‚â€œé¦–ç¬”äº¤æ˜“å…è´¹â€ï¼‰ã€‚
    * **æŠ€æœ¯æ ˆ**ï¼šERC-4337 v0.6 é€»è¾‘ï¼Œæ‰‹åŠ¨å®šä¹‰ `UserOperation` ç»“æ„ã€‚

* **V2: FishCakeOraclePaymaster (DeFi Edition)** ğŸŒŸ
    * **æ ¸å¿ƒåŠŸèƒ½**ï¼šç”¨æˆ·ä½¿ç”¨ ERC20 ä»£å¸ï¼ˆå¦‚ USDCï¼‰æ”¯ä»˜ Gasã€‚
    * **æŠ€æœ¯æ ‡å‡†**ï¼šå…¨é¢é€‚é… **ERC-4337 v0.7.0** ç”Ÿäº§æ ‡å‡†ã€‚
    * **é¢„è¨€æœºé›†æˆ**ï¼šæ¥å…¥ **Chainlink AggregatorV3**ï¼Œå®ç° ETH/USD å®æ—¶åŠ¨æ€æ±‡ç‡ç»“ç®—ã€‚
    * **ç›ˆåˆ©æ¨¡å‹**ï¼šå†…ç½® `PRICE_MARKUP` æœºåˆ¶ï¼Œè‡ªåŠ¨èµšå– 10% æœåŠ¡è´¹ï¼Œå®ç°åè®®è‡ªå¢é•¿ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ·±åº¦ (Technical Deep Dive)

### ä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹© ERC-4337 v0.7.0ï¼Ÿ
æœ¬é¡¹ç›®æ”»å…‹äº† v0.7.0 é‡æ„å¸¦æ¥çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼Œç¡®ä¿ä»£ç å¤„äºè¡Œä¸šæœ€å‰æ²¿ï¼š

* **PackedUserOperation**: ä¼˜åŒ–äº†æ•°æ®ç»“æ„ï¼Œå°† Gas å‚æ•°æ‰“åŒ…å‹ç¼©ï¼Œæ˜¾è‘—é™ä½äº†ç”¨æˆ·çš„é“¾ä¸Šæˆæœ¬ã€‚
* **4-Param `_postOp`**: é€‚é…äº†æœ€æ–°çš„ç»“ç®—ç­¾åï¼Œé€šè¿‡ `actualUserOpFeePerGas` å‚æ•°å®ç°æé«˜ç²¾åº¦çš„è´¹ç”¨åˆ†æ‘Šã€‚
* **Atomic Access Control**: é‡‡ç”¨åŸå­åŒ–æ„é€ å‡½æ•° `BasePaymaster(entryPoint, owner)`ï¼Œä»éƒ¨ç½²ç¬é—´æœç»æƒé™æŠ¢å é£é™©ã€‚



### é¢„è¨€æœºå®‰å…¨å®è·µ
åœ¨ `FishCakeOraclePaymaster` ä¸­ï¼Œæˆ‘ä»¬å®æ–½äº†ä¸¥æ ¼çš„å·¥ä¸šçº§é¢„è¨€æœºé˜²å¾¡ï¼š
```solidity
// æ£€æŸ¥é¢„è¨€æœºæ•°æ®çš„æ—¶æ•ˆæ€§ï¼Œé˜²æ­¢ Stale Price (è¿‡æ—¶å–‚ä»·) æ”»å‡»
require(timeStamp > 0, "Chainlink: stale price");
require(price > 0, "Chainlink: invalid price");

```

---

## ğŸ—ï¸ ä»“åº“ç›®å½•ç»“æ„

```text
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ FishCakeSmartAccount.sol   # æ ¸å¿ƒæ™ºèƒ½é’±åŒ…é€»è¾‘
â”‚   â”œâ”€â”€ FishCakeFactory.sol        # åŸºäº CREATE2 çš„å¤šé“¾åŒåœ°å€å·¥å‚
â”‚   â””â”€â”€ paymasters/
â”‚       â”œâ”€â”€ FishCakePaymaster.sol       # [Legacy] V1 - åŸºç¡€ç™½åå•ä»£ä»˜
â”‚       â””â”€â”€ FishCakeOraclePaymaster.sol # [Advanced] V2 - é¢„è¨€æœºä»£å¸æ”¯ä»˜ (v0.7)
â”œâ”€â”€ lib/                           # ä¾èµ–åº“ (Account Abstraction v0.7, OpenZeppelin)
â””â”€â”€ test/                          # è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

```

---

## ğŸ›¡ï¸ åŸåˆ›æ€§å£°æ˜

æœ¬é¡¹ç›®ç”± **Monster-Three** ç‹¬ç«‹å¼€å‘ï¼Œæ ¸å¿ƒä»£ç é€»è¾‘ï¼ˆç‰¹åˆ«æ˜¯é’ˆå¯¹ v0.7 ç‰ˆæœ¬çš„å…¼å®¹æ€§é‡æ„ï¼‰å‡ä¸ºåŸåˆ›ã€‚æˆ‘ä»¬é€šè¿‡å¯¹åº•å±‚åº“å˜åŠ¨çš„æ·±åº¦é€‚é…ï¼Œè¯æ˜äº†é¡¹ç›®åœ¨å¤šé“¾ç¯å¢ƒä¸‹çš„ç”Ÿäº§å¯ç”¨æ€§ã€‚

---

## âš™ï¸ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
forge install eth-infinitism/account-abstraction@v0.7.0 --no-commit
forge install smartcontractkit/chainlink-brownie-contracts --no-commit

```

### ç¼–è¯‘é¡¹ç›®

```bash
forge build

```

---

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](https://www.google.com/search?q=LICENSE) æˆæƒã€‚

